create database carsshowroom;

use carsshowroom;

create table showrooms(
showroom_id int,
name varchar(50),
city varchar(50)
);

create table cars(
car_id int,
brand varchar(50),
model varchar(50),
price decimal(10,2),
showroom_id int
);

create table customers(
customer_id int,
name varchar(50),
phone varchar(50),
city varchar(50)
);

create table sales(
sale_id int,
customer_id int,
car_id int,
sale_date date
);

insert into showrooms values
(1,'Elite Moters','mumbai'),
(2,'Super cars','delhi'),
(3,'Dream Wheels','bangalore');

insert into cars values
(101, 'Toyota', 'Fortuner', 3500000, 1),
(102, 'Hyundai', 'Creta', 1500000, 1),
(103, 'Maruti', 'Swift', 800000, 2),
(104, 'Honda', 'City', 1200000, 2),
(105, 'BMW', 'X5', 7500000, 3),
(106, 'Audi', 'A6', 6500000, 3);

insert into customers values
(201,'Rahul Sharma','9876543210','mumbai'),
(202,'Priya Varma','8765432109','delhi'),
(203,'Amit Singh','7654321098','bangalore'),
(204,'Sneha Rao','6543210987','mumbai'),
(205,'Karan Mehta','9123456780','delhi');

insert into sales values
(301,201,101,'2025-01-15'),
(302,202,103,'2025-02-10'),
(303,203,105,'2025-03-12'),
(304,204,102,'2025-04-05'),
(305,205,104,'2025-05-20'),
(306,201,106,'2025-06-11');

-- 1.List all cars available in the Mumbai showroom.
select c.car_id, c.brand, c.model, c.price
from cars c
join showrooms s
on c.showroom_id = s.showroom_id
where s.city = 'mumbai';

-- 2.Find the total number of cars in each showroom.
select s.showroom_id, count(c.car_id)
from cars c
join showrooms s
on c.showroom_id = s.showroom_id
group by s.showroom_id;

-- 3.Show the details of cars priced above â‚¹20,00,000.
select c.car_id, c.brand, c.model, c.price
from cars c
where price >2000000;

-- 4.Retrieve all customers who live in the same city as the showroom Elite Moters.
select c.customer_id, c.name, c.phone, c.city
from customers c
join showrooms s
on c.city = s.city
where s.name= 'Elite Moters';

-- 5.Find the most expensive car in each showroom.
select c.showroom_id, s.name as showroom_name, c.brand, c.model, c.price 
from cars c
join showrooms s
on s.showroom_id = c.showroom_id
where c.price =(
select max(price)
from cars
where showroom_id = c.showroom_id
);

-- 6.Show customer names along with the cars they purchased.
select cu.name AS customer_name, ca.brand, ca.model, ca.price
FROM sales sa
JOIN customers cu ON sa.customer_id = cu.customer_id
JOIN cars ca ON sa.car_id = ca.car_id;

-- 7.List all sales made in the year 2024.
select sa.sale_date, cu.name, ca.model,sa.sale_id
from sales sa
join customers cu on sa.customer_id = cu.customer_id
join cars ca on ca.car_id = sa.car_id
where year(sa.sale_date) = 2024;

-- 8. Find the total sales amount generated by each showroom.
select s.showroom_id, s.name, sum(c.price) as total_sale_amount
from sales sa
join cars c on sa.car_id = c.car_id
join showrooms s on c.showroom_id =  s.showroom_id
group by s.showroom_id, s.name;

-- 9.Display customers who have purchased more than one car.
select cu.customer_id, cu.name, count(sa.car_id) as cars_purchased
from sales sa
join customers cu on cu.customer_id = sa.customer_id
group by cu.customer_id, cu.name
having count(sa.car_id)> 1;

-- 10.Find which car model is the most sold.
select c.model, count(c.car_id) as total_sold_cars
from sales s
join cars c on s.car_id = c.car_id
group by c.model
order by total_sold_cars desc
limit 1;  

-- 11. Show the sales details where the customer and showroom city are the same.
select c.customer_id, c.name, c.phone, c.city
from customers c
join sales sa on c.customer_id = sa.customer_id
join showrooms s on c.city = s.city;

-- 12. Get the total number of cars sold per brand.
select c.brand, count(c.car_id) as total_sold_cars
from sales s
join cars c on s.car_id = c.car_id
group by c.brand
order by total_sold_cars;

-- 13. List customers who have not purchased any car.
select cu.customer_id, cu.name
from customers cu
left join sales sa on cu.customer_id = sa.customer_id
where sa.sale_id is null;

-- 14. Find the average price of cars sold from the showroom Dream Wheels.
select c.car_id, c.brand, c.model, avg(c.price) as avg_price
from cars c
join showrooms s
on c.showroom_id = s.showroom_id
where s.name='Dream Wheels'
group by c.car_id, c.brand, c.model;

-- 15. Retrieve the top 3 most expensive cars along with their showroom names.
select c.car_id, c.brand, c.model, c.price, s.name
from cars c
join showrooms s on c.showroom_id = s.showroom_id
order by c.price desc
limit 3;